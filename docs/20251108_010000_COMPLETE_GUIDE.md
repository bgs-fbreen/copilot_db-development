# BGS Copilot Complete Guide - Session 2025-11-08

## Database: copilot_db @ 192.168.30.180:5432, Schema: bgs, User: frank

## Critical Schema Notes
- **There is NO `vendor_code` on `bgs.project`** as of 2025-11-07.
- Always use `res_id` (e.g. `F.Breen`) for all exports and scripts.  
  _Do NOT use `res_name` (e.g. `Breen Geoscience`). Results and directories will be incorrect._
- Want to check schema?  
  ```sql
  SELECT column_name FROM information_schema.columns WHERE table_schema='bgs' AND table_name='project';
  ```

## Directory Format
Projects = `{client}/{project_code}_{abbreviated_name}/`  
Example: `CNH/cnh.25.1897_GW-SMR/`

Each **project** contains:
- `01_baseline/`
- `02_invoices/`
- `03_authorization/`
- `04_subcontractors/`
- `05_reports/`

## Key Commands
- `copilot project setup-all`
- `copilot project list --status active`
- `copilot invoice baseline {project} --open`
- `copilot invoice workbook {project} --open`
- For full rebuild of project directories:  
  ```sh
  find /mnt/sda1/01_bgm_projman/Active -mindepth 2 -maxdepth 2 -type d -exec rm -rf {} +
  copilot project setup-all
  ```

## Key Files
- `copilot/db.py`                — Database connection/logic
- `copilot/utils.py`             — Directory naming & helpers
- `copilot/commands/baseline_export_cmd.py` — Baseline PDF exporter
- `copilot/commands/project_workbook_cmd.py` — XLSX workbook generator
- `copilot/commands/project_setup_cmd.py`    — Project setup

## Installation Quick Reference
```sh
cd ~/git-breengeosci/copilot_db-development
source ~/project_env/bin/activate
pip install -e .
```

## Export Format Example / Gotchas

**ALWAYS** check that:
- Your SQL queries match the current actual schema (see above for how!)
- Your exports use `res_id` not `res_name`
- You do NOT reference fields that do not exist in the DB

**Sample Output Snippet for Correct XLSX Invoice Header:**
```
Invoice
Breen GeoScience Management, Inc.      [Right side: Project Name]
Payment to:
  Breen GeoScience Management, Inc.
  PMB #354, 4234 I-75 Business Spur
  Sault Ste. Marie, Michigan USA 49783
  (Other client/project lines as needed)
```

_If you get errors about missing columns, double-check the schema and this guide!_

---

**Contact: Frank Breen — frank@breengeosci.com**
