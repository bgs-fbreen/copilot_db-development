# Baseline XLSX Generator Progress and Setup

## Project Purpose
You are building a script to automatically generate a formatted Baseline Excel (XLSX) file for each active project, using data from your PostgreSQL database. This is part of standardizing folder structures and cost tracking for all projects.

---

## Features and Requirements Implemented

- **Folder Structure**:  
  - For each active project:  
    `/mnt/sda1/01_bgm_projman/Active/{client_code}/{project_code}_{project_name}/`
  - Standard subfolders, including `01_baseline`
- **Data Source**:  
  - Pulls from `bgs.project`, `bgs.client`, `bgs.baseline`, `bgs.task`
- **Output XLSX Design**:
  - Header blocks (company info, client info, addresses, and project metadata)
  - Project and client info cells are left-aligned in columns E2–E10
  - One section per project `task`
  - **Tables:**
    - Resource column is always `bgs.baseline.res_id`
    - Table headings have light gray background, only header rows have borders
    - Description heading is left-aligned, same size as other headers; data is smaller, wrapped font
    - "Units" (column C) is centered in data rows
    - For each line, "Total" in column E comes directly from database
    - If a line uses a subtask, Description is: `<sub_task_no>: <task_name> <task_notes>`
    - Lump sum rows: "Expense" column blank, "Total" filled
  - **Subtotals:** Placed under each task table (though the SUM formula in excel is not yet working reliably—see TODO)
  - **Labor/Material/Expense Sub Total & Baseline Total:** also show Excel SUM formulas over the subtotals (also not working reliably—see TODO)

---

## Technical Setup

- Script is at:  
  `/home/frank/git-breengeosci/copilot_db-development/copilot/commands/create_projects_and_baseline.py`
- Requires Python, `psycopg2`, and `xlsxwriter`
  - Install via: `pip install psycopg2-binary xlsxwriter`
- To run:  
  ```
  /home/frank/git-breengeosci/copilot_db-development/copilot/commands/create_projects_and_baseline.py
  ```
- The script automatically recreates all baseline files for **all active projects**.

---

## Open Issues / TODOs

- **Excel Subtotals and Grand Totals Formulas**:  
  - The script *writes* the correct cell formula for subtotals and totals, but on review, Excel sometimes displays 0 or does not calculate as intended for all lines.
  - Debugging and finalizing the correct SUM formula row ranges for multi-line and single-line tasks is the next task.

---

## Next Steps

1. Debug/fix why subtotal and grand total SUM formulas are not calculating “live” in column E.
2. (If needed) Test formula string construction and cell index math for all edge cases (single row, multi row sections).
3. Confirm everything works in sample XLSX with actual Excel (not only LibreOffice or preview).

---

*End of Day Summary 2025-11-08*

---
